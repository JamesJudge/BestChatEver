{"ast":null,"code":"import _slicedToArray from\"/var/www/html/chat.videovoyager.org/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useRef,useState}from'react';import Placeholder from'./placeholder';import PlayerControls from'./PlayerControls';import{CONTROLS,POSITION}from'./config';import{isElementInViewport}from'./utils';import'./MiniPlayer.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CORNER_SPACE=32;var DEFAULT_POSITION='auto';var TRANSITION='200ms ease-in-out';var MiniPlayer=function MiniPlayer(props){var _window=window,IVSPlayer=_window.IVSPlayer;var isPlayerSupported=IVSPlayer.isPlayerSupported;var _props$controls=props.controls,controls=_props$controls===void 0?[CONTROLS.mute,CONTROLS.close,CONTROLS.resize]:_props$controls,_props$position=props.position,position=_props$position===void 0?POSITION.bottomRight:_props$position,_props$height=props.height,height=_props$height===void 0?154:_props$height,_props$width=props.width,width=_props$width===void 0?274:_props$width,streamUrl=props.streamUrl,transition=props.transition;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isMiniPlayer=_useState4[0],setIsMiniPlayer=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),muted=_useState6[0],setMuted=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),playerPosition=_useState8[0],setPlayerPosition=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),playerSize=_useState10[0],setPlayerSize=_useState10[1];var player=useRef(null);var playerBaseEl=useRef(null);var videoEl=useRef(null);var visibleRef=useRef(null);// handle case when autoplay with sound is blocked by browser\nuseEffect(function(){if(!player.current)return;setMuted(player.current.isMuted());},[loading]);var updatePlayer=useCallback(function(isMini){var top=DEFAULT_POSITION;var right=DEFAULT_POSITION;var bottom=DEFAULT_POSITION;var left=DEFAULT_POSITION;var targetPosition=0;var targetHeight='100%';var targetWidth='100%';if(isMini){targetPosition=\"\".concat(CORNER_SPACE,\"px\");targetHeight=\"\".concat(height,\"px\");targetWidth=\"\".concat(width,\"px\");}switch(position){case POSITION.topLeft:top=targetPosition;left=targetPosition;break;case POSITION.topRight:top=targetPosition;right=targetPosition;break;case POSITION.bottomLeft:bottom=targetPosition;left=targetPosition;break;default:bottom=targetPosition;right=targetPosition;}setPlayerSize({height:targetHeight,width:targetWidth});setPlayerPosition({top:top,right:right,bottom:bottom,left:left});},[height,width,position]);useEffect(function(){var _IVSPlayer$PlayerStat=IVSPlayer.PlayerState,ENDED=_IVSPlayer$PlayerStat.ENDED,PLAYING=_IVSPlayer$PlayerStat.PLAYING,READY=_IVSPlayer$PlayerStat.READY;var ERROR=IVSPlayer.PlayerEventType.ERROR;if(!isPlayerSupported){console.warn('The current browser does not support the Amazon IVS player.');return;}var onStateChange=function onStateChange(){var playerState=player.current.getState();console.log(\"Player State - \".concat(playerState));setLoading(playerState!==PLAYING);};var onError=function onError(err){console.warn('Player Event - ERROR:',err);};player.current=IVSPlayer.create();player.current.attachHTMLVideoElement(videoEl.current);player.current.load(streamUrl);player.current.play();player.current.addEventListener(READY,onStateChange);player.current.addEventListener(PLAYING,onStateChange);player.current.addEventListener(ENDED,onStateChange);player.current.addEventListener(ERROR,onError);return function(){player.current.removeEventListener(READY,onStateChange);player.current.removeEventListener(PLAYING,onStateChange);player.current.removeEventListener(ENDED,onStateChange);player.current.removeEventListener(ERROR,onError);};},[IVSPlayer,isPlayerSupported,streamUrl]);useEffect(function(){var onVisibilityChange=function onVisibilityChange(){var visible=isElementInViewport(playerBaseEl.current);if(visible===visibleRef.current)return;visibleRef.current=visible;if(visible&&player.current.isPaused()){player.current.play();}if(!visible){var playerRect=playerBaseEl.current.getBoundingClientRect();setPlayerSize({height:\"\".concat(playerRect.height,\"px\"),width:\"\".concat(playerRect.width-CORNER_SPACE,\"px\")});}setTimeout(function(){setIsMiniPlayer(!visible);},100);};if(!isPlayerSupported){return;}onVisibilityChange();updatePlayer(visibleRef.current);window.addEventListener('scroll',onVisibilityChange);window.addEventListener('resize',onVisibilityChange);return function(){window.removeEventListener('scroll',onVisibilityChange);window.removeEventListener('resize',onVisibilityChange);};},[isPlayerSupported,updatePlayer]);useEffect(function(){updatePlayer(isMiniPlayer);},[isMiniPlayer,updatePlayer]);var close=function close(){player.current.pause();setIsMiniPlayer(false);};var resize=function resize(){var _playerBaseEl$current=playerBaseEl.current,offsetLeft=_playerBaseEl$current.offsetLeft,offsetTop=_playerBaseEl$current.offsetTop;window.scrollTo({top:offsetTop-20,left:offsetLeft,behavior:'smooth'});};var toggleMute=function toggleMute(){var shouldMute=!player.current.isMuted();player.current.setMuted(shouldMute);setMuted(shouldMute);};if(!isPlayerSupported){return null;}var top=playerPosition.top,right=playerPosition.right,bottom=playerPosition.bottom,left=playerPosition.left;return/*#__PURE__*/_jsx(\"div\",{className:\"MiniPlayer\",ref:playerBaseEl,children:/*#__PURE__*/_jsxs(\"div\",{className:\"MiniPlayer-videoBox\",children:[/*#__PURE__*/_jsx(Placeholder,{loading:loading}),/*#__PURE__*/_jsxs(\"div\",{className:\"MinPlayer-video\".concat(isMiniPlayer?' small':''),style:{top:top,right:right,bottom:bottom,left:left,width:\"\".concat(playerSize.width),height:\"\".concat(playerSize.height),transition:transition&&isMiniPlayer?\"height \".concat(TRANSITION,\", width \").concat(TRANSITION):'none'},children:[/*#__PURE__*/_jsx(\"video\",{ref:videoEl,playsInline:true}),isMiniPlayer&&/*#__PURE__*/_jsx(PlayerControls,{controls:controls,muted:muted,onClose:close,onResize:resize,onMute:toggleMute})]})]})});};export default MiniPlayer;","map":{"version":3,"sources":["/var/www/html/chat.videovoyager.org/src/components/mini-player/MiniPlayer.jsx"],"names":["React","useCallback","useEffect","useRef","useState","Placeholder","PlayerControls","CONTROLS","POSITION","isElementInViewport","CORNER_SPACE","DEFAULT_POSITION","TRANSITION","MiniPlayer","props","window","IVSPlayer","isPlayerSupported","controls","mute","close","resize","position","bottomRight","height","width","streamUrl","transition","loading","setLoading","isMiniPlayer","setIsMiniPlayer","muted","setMuted","playerPosition","setPlayerPosition","playerSize","setPlayerSize","player","playerBaseEl","videoEl","visibleRef","current","isMuted","updatePlayer","isMini","top","right","bottom","left","targetPosition","targetHeight","targetWidth","topLeft","topRight","bottomLeft","PlayerState","ENDED","PLAYING","READY","ERROR","PlayerEventType","console","warn","onStateChange","playerState","getState","log","onError","err","create","attachHTMLVideoElement","load","play","addEventListener","removeEventListener","onVisibilityChange","visible","isPaused","playerRect","getBoundingClientRect","setTimeout","pause","offsetLeft","offsetTop","scrollTo","behavior","toggleMute","shouldMute"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\n\nimport Placeholder from './placeholder';\nimport PlayerControls from './PlayerControls';\n\nimport { CONTROLS, POSITION } from './config';\nimport { isElementInViewport } from './utils';\n\nimport './MiniPlayer.css';\n\nconst CORNER_SPACE = 32;\nconst DEFAULT_POSITION = 'auto';\nconst TRANSITION = '200ms ease-in-out';\n\nconst MiniPlayer = (props) => {\n  const { IVSPlayer } = window;\n  const { isPlayerSupported } = IVSPlayer;\n\n  const {\n    controls = [CONTROLS.mute, CONTROLS.close, CONTROLS.resize],\n    position = POSITION.bottomRight,\n    height = 154,\n    width = 274,\n    streamUrl,\n    transition,\n  } = props;\n\n  const [loading, setLoading] = useState(true);\n  const [isMiniPlayer, setIsMiniPlayer] = useState(false);\n  const [muted, setMuted] = useState(false);\n\n  const [playerPosition, setPlayerPosition] = useState({});\n  const [playerSize, setPlayerSize] = useState({});\n\n  const player = useRef(null);\n  const playerBaseEl = useRef(null);\n  const videoEl = useRef(null);\n  const visibleRef = useRef(null);\n\n  // handle case when autoplay with sound is blocked by browser\n  useEffect(() => {\n    if (!player.current) return;\n\n    setMuted(player.current.isMuted());\n  }, [loading]);\n\n  const updatePlayer = useCallback(\n    (isMini) => {\n      let top = DEFAULT_POSITION;\n      let right = DEFAULT_POSITION;\n      let bottom = DEFAULT_POSITION;\n      let left = DEFAULT_POSITION;\n\n      let targetPosition = 0;\n      let targetHeight = '100%';\n      let targetWidth = '100%';\n\n      if (isMini) {\n        targetPosition = `${CORNER_SPACE}px`;\n        targetHeight = `${height}px`;\n        targetWidth = `${width}px`;\n      }\n\n      switch (position) {\n        case POSITION.topLeft:\n          top = targetPosition;\n          left = targetPosition;\n\n          break;\n        case POSITION.topRight:\n          top = targetPosition;\n          right = targetPosition;\n\n          break;\n        case POSITION.bottomLeft:\n          bottom = targetPosition;\n          left = targetPosition;\n\n          break;\n        default:\n          bottom = targetPosition;\n          right = targetPosition;\n      }\n\n      setPlayerSize({\n        height: targetHeight,\n        width: targetWidth,\n      });\n      setPlayerPosition({\n        top,\n        right,\n        bottom,\n        left,\n      });\n    },\n    [height, width, position],\n  );\n\n  useEffect(() => {\n    const { ENDED, PLAYING, READY } = IVSPlayer.PlayerState;\n    const { ERROR } = IVSPlayer.PlayerEventType;\n\n    if (!isPlayerSupported) {\n      console.warn(\n        'The current browser does not support the Amazon IVS player.',\n      );\n\n      return;\n    }\n\n    const onStateChange = () => {\n      const playerState = player.current.getState();\n\n      console.log(`Player State - ${playerState}`);\n      setLoading(playerState !== PLAYING);\n    };\n\n    const onError = (err) => {\n      console.warn('Player Event - ERROR:', err);\n    };\n\n    player.current = IVSPlayer.create();\n    player.current.attachHTMLVideoElement(videoEl.current);\n    player.current.load(streamUrl);\n    player.current.play();\n\n    player.current.addEventListener(READY, onStateChange);\n    player.current.addEventListener(PLAYING, onStateChange);\n    player.current.addEventListener(ENDED, onStateChange);\n    player.current.addEventListener(ERROR, onError);\n\n    return () => {\n      player.current.removeEventListener(READY, onStateChange);\n      player.current.removeEventListener(PLAYING, onStateChange);\n      player.current.removeEventListener(ENDED, onStateChange);\n      player.current.removeEventListener(ERROR, onError);\n    };\n  }, [IVSPlayer, isPlayerSupported, streamUrl]);\n\n  useEffect(() => {\n    const onVisibilityChange = () => {\n      const visible = isElementInViewport(playerBaseEl.current);\n\n      if (visible === visibleRef.current) return;\n\n      visibleRef.current = visible;\n\n      if (visible && player.current.isPaused()) {\n        player.current.play();\n      }\n\n      if (!visible) {\n        const playerRect = playerBaseEl.current.getBoundingClientRect();\n        setPlayerSize({\n          height: `${playerRect.height}px`,\n          width: `${playerRect.width - CORNER_SPACE}px`,\n        });\n      }\n\n      setTimeout(() => {\n        setIsMiniPlayer(!visible);\n      }, 100);\n    };\n\n    if (!isPlayerSupported) {\n      return;\n    }\n\n    onVisibilityChange();\n    updatePlayer(visibleRef.current);\n\n    window.addEventListener('scroll', onVisibilityChange);\n    window.addEventListener('resize', onVisibilityChange);\n\n    return () => {\n      window.removeEventListener('scroll', onVisibilityChange);\n      window.removeEventListener('resize', onVisibilityChange);\n    };\n  }, [isPlayerSupported, updatePlayer]);\n\n  useEffect(() => {\n    updatePlayer(isMiniPlayer);\n  }, [isMiniPlayer, updatePlayer]);\n\n  const close = () => {\n    player.current.pause();\n    setIsMiniPlayer(false);\n  };\n\n  const resize = () => {\n    const { offsetLeft, offsetTop } = playerBaseEl.current;\n\n    window.scrollTo({\n      top: offsetTop - 20,\n      left: offsetLeft,\n      behavior: 'smooth',\n    });\n  };\n\n  const toggleMute = () => {\n    const shouldMute = !player.current.isMuted();\n\n    player.current.setMuted(shouldMute);\n    setMuted(shouldMute);\n  };\n\n  if (!isPlayerSupported) {\n    return null;\n  }\n\n  const { top, right, bottom, left } = playerPosition;\n\n  return (\n    <div className=\"MiniPlayer\" ref={playerBaseEl}>\n      <div className=\"MiniPlayer-videoBox\">\n        <Placeholder loading={loading} />\n\n        <div\n          className={`MinPlayer-video${isMiniPlayer ? ' small' : ''}`}\n          style={{\n            top,\n            right,\n            bottom,\n            left,\n            width: `${playerSize.width}`,\n            height: `${playerSize.height}`,\n            transition:\n              transition && isMiniPlayer\n                ? `height ${TRANSITION}, width ${TRANSITION}`\n                : 'none',\n          }}\n        >\n          <video ref={videoEl} playsInline></video>\n\n          {isMiniPlayer && (\n            <PlayerControls\n              controls={controls}\n              muted={muted}\n              onClose={close}\n              onResize={resize}\n              onMute={toggleMute}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MiniPlayer;\n"]},"metadata":{},"sourceType":"module"}